一：mq的相关面试题

1：系统为啥使用mq

（1）：异步处理其他任务

（2）：解耦：解决不同系统之间的依赖调用

（3）：削峰填谷：将高峰期数据放入消息队列中排队而不直接并发请求数据库

2：mq的优缺点

（1）：系统可用性降低：若mq挂掉了，数据会丢失，可用性降低

（2）：复杂性提高：需要考虑消息重复性、消息丢失、消息顺序性问题

（3）：数据一致性问题：在a系统发送消息后，认为成功了，但b系统写入数据库时失败了，就会产生数据一致性问题

3：如何解决消息丢失问题

（1）消息生产端：
1：使用事务，当消息没有成功发送到rabbitMq时，生产者会出现异常，这时可以进行事务回滚，然后重新发送消息，但这样会导致生产者性能和吞吐量降低（同步）；
2：confirm机制：每次发送消息的时候会在生产者端生成一个唯一id，rabbitmq收到消息之后会回传一个ack，若未收到则会回调Nack（异步），然后进行重发。采用多

（2）rabbitmq存储阶段：单机rabbitMq宕机之后会造成消息丢失；
1：通过持久化机制：1：创建队列时设置持久化。2：发送消息时，将deliveryModel设置为2持久化

2：集群：防止单机mq宕机

（3）消费端：消费端收到ack接收消息，

4：如何保证消息重复性

通过幂等性：为消息设置一个唯一id，在redis中存储已消费的消息，在消费之前进行比对；已消费过的就不进行消费

5：如何保证mq的高可用

1：普通集群模式：在多台机器上启动多个mq实例，但创建的队列只会保存在master的实例上，其他实例同步接收master实例的消息，若master宕机了，也会造成消息丢失

2：镜像集群模式：多台机器启动多个实例，创建队列都会保存到各个mq实例中，写入queue的消息也会同步到其他mq实例中；但性能开销较大，消息需要同步所有机器，网络带宽压力大
