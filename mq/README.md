一：mq的相关面试题

1：系统为啥使用mq

（1）：异步处理其他任务

（2）：解耦：解决不同系统之间的依赖调用

（3）：削峰填谷：将高峰期数据放入消息队列中排队而不直接并发请求数据库

2：mq的优缺点

（1）：系统可用性降低：若mq挂掉了，数据会丢失，可用性降低

（2）：复杂性提高：需要考虑消息重复性、消息丢失、消息顺序性问题

（3）：数据一致性问题：在a系统发送消息后，认为成功了，但b系统写入数据库时失败了，就会产生数据一致性问题

3：如何解决消息丢失问题

（1）消息生产端：
1：使用事务，当消息没有成功发送到rabbitMq时，生产者会出现异常，这时可以进行事务回滚，然后重新发送消息，但这样会导致生产者性能和吞吐量降低（同步）；
2：confirm机制：每次发送消息的时候会在生产者端生成一个唯一id，rabbitmq收到消息之后会回传一个ack，若未收到则会回调Nack（异步），然后进行重发。采用多

（2）rabbitmq存储阶段：单机rabbitMq宕机之后会造成消息丢失；
1：通过持久化机制：1：创建队列时设置持久化。2：发送消息时，将deliveryModel设置为2持久化

2：集群：防止单机mq宕机

（3）消费端：消费端收到ack接收消息，

4：如何保证消息重复性

通过幂等性：为消息设置一个唯一id，在redis中存储已消费的消息，在消费之前进行比对；已消费过的就不进行消费

5：如何保证mq的高可用

1：普通集群模式：在多台机器上启动多个mq实例，但创建的队列只会保存在master的实例上，其他实例同步接收master实例的消息，若master宕机了，也会造成消息丢失

2：镜像集群模式：多台机器启动多个实例，创建队列都会保存到各个mq实例中，写入queue的消息也会同步到其他mq实例中；但性能开销较大，消息需要同步所有机器，网络带宽压力大

二：AMQP高级消息队列协议核心概念

1：Server：也叫Broker，接受客户端连接，实现AMQP实体服务。

2：Connection：应用程序与Broker的网络连接

3：Channel：网络信道，Channel是进行消息读写的通道，每个Channel代表一个会话任务

4：Message :消息：服务与应用程序之间传送的数据，由Properties和body组成，Properties可是对消息进行修饰，比如消息的优先级，延迟等高级特性，Body则就是消息体的内容。

5：Virtual Host 虚拟地址，用于进行逻辑隔离，最上层的消息路由，一个虚拟主机理由可以有若干个Exhange和Queueu，同一个虚拟主机里面不能有相同名字的Exchange或Queueu

6：Exchange：交换机，接受消息，根据路由键发送消息到绑定的队列。

7：Bindings：Exchange和Queue之间的虚拟连接，binding中可以绑定多个routing key.

8：Routing key：是一个路由规则，虚拟机可以用它来确定如何路由一个特定消息。

9：Queue：队列：也成为Message Queue,消息队列，保存消息并将它们转发给消费者。
  
